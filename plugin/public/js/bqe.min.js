!function(){var e=new function(){var u;return{showProviders:function(e){$("#sel0").show(),$("#btn-provider-add").show().prop("disabled",1!==u.cType),$("#provider").empty(),$.each(e,function(e,t){$("#provider").append(t)}),$("#provider").children().first().addClass("ui-selected"),u.changeProvider($("#provider").children().first().data("sref"),u.showChannels),u.setHover("#provider")},showChannels:function(e){$("#channels").empty(),$.each(e,function(e,t){$("#channels").append(t)}),u.setChannelButtons(),u.setHover("#channels")},showBouquets:function(e){$("#bql").empty(),$.each(e,function(e,t){$("#bql").append(t)}),$("#bql").children().first().addClass("ui-selected"),u.changeBouquet($("#bql").children().first().data("sref"),u.showBouquetChannels),u.setHover("#bql")},showBouquetChannels:function(e){$("#bqs").empty(),$.each(e,function(e,t){$("#bqs").append(t)}),u.setBouquetChannelButtons(),u.setHover("#bqs")},buildRefStr:function(e){let t="1:7:2:0:0:0:0:0:0:0:(type == 2) || (type == 10) ";return 0===u.Mode&&(t="1:7:1:0:0:0:0:0:0:0:(type == 1) || (type == 17) || (type == 195) || (type == 25) || (type == 22) || (type == 31) || (type == 211) "),0===e?t=(t+='FROM BOUQUET "bouquets.')+(0===u.Mode?"tv":"radio")+'" ORDER BY bouquet':1===e?t+="FROM PROVIDERS ORDER BY name":2===e?t+="FROM SATELLITES ORDER BY satellitePosition":3===e&&(t+="ORDER BY name"),t},setTvRadioMode:function(e){let t=!1;e===u.Mode&&3!==e||(t=!0),u.Mode=1<e?0:e,0===u.cType?u.getSatellites(u.showProviders):1===u.cType?u.getProviders(u.showProviders):2===u.cType&&($("#sel0").hide(),u.getChannels(u.showChannels)),t&&u.getBouquets(u.showBouquets)},getSatellites:function(t){u.cType=0;var e=u.buildRefStr(2),s=0===u.Mode?"tv":"radio";$.ajax({url:"/api/getsatellites",dataType:"json",cache:!0,data:{sRef:e,stype:s,date:u.date},success:function(e){let a=[];e=e.satellites;$.each(e,function(e,t){var s=t.service,t=t.name;a.push($("<li/>",{class:"ui-widget-content",data:{sref:s}}).html(t))}),t&&t(a)}})},getProviders:function(t){u.cType=1;var e=u.buildRefStr(1);$.ajax({url:"/api/getservices",dataType:"json",cache:!0,data:{sRef:e,date:u.date},success:function(e){let a=[];e=e.services;$.each(e,function(e,t){var s=t.servicereference,t=t.servicename;a.push($("<li/>",{class:"ui-widget-content",data:{sref:s}}).html(t))}),t&&t(a)}})},getChannels:function(t){u.cType=2;var e=u.buildRefStr(3);$.ajax({url:"/api/getservices?sRef="+e+"&showproviders=1",dataType:"json",cache:!0,data:{date:u.date},success:function(e){u.allChannelsCache=e.services,u.filterChannelsCache=e.services,u.fillChannels(t)}})},fillChannels:function(e){let i=[];$.each(u.filterChannelsCache,function(e,t){var s=t.servicereference,a=t.servicename,t=t.provider,o=s.split(":")[2],n=s.split(":")[6],t='<span title="'+t+'" class="marker">'+u.getNS(n)+" "+(u.sType[o]||"")+"</span>";i.push($("<li/>",{class:"ui-widget-content",data:{stype:o,sref:s}}).html(a+t))}),e&&e(i)},getBouquets:function(t){u.bqStartPositions={};var e=u.buildRefStr(0);$.ajax({url:"/bouqueteditor/api/getservices",dataType:"json",cache:!1,data:{sRef:e},success:function(e){let a=[];e=e.services;$.each(e,function(e,t){u.bqStartPositions[t.servicereference]=t.startpos;var s=t.servicereference,t=t.servicename;a.push($("<li/>",{class:"ui-widget-content",data:{sref:s}}).html('<div class="handle"><span class="ui-icon ui-icon-dragndrop"></span></div>'+t+"</li>"))}),t&&t(a)}})},changeProvider:function(e,t){$.ajax({url:"/api/getservices",dataType:"json",cache:!0,data:{sRef:e,date:u.date,provider:"1"},success:function(e){u.allChannelsCache=e.services,u.filterChannelsCache=e.services,u.fillChannels(t)}})},changeBouquet:function(e,t){let r=0;u.bqStartPositions[e]&&(r=u.bqStartPositions[e]),$.ajax({url:"/bouqueteditor/api/getservices",dataType:"json",cache:!1,data:{sRef:e},success:function(e){let i=[];e=e.services;$.each(e,function(e,t){var s=t.servicereference;let a=1==t.ismarker?'<span style="float:right">(M)</span>':"";var o=t.servicename,n=r+t.pos;2==t.ismarker&&(a='<span style="float:right">(S)</span>'),(o=n.toString()+" - "+o)&&i.push($("<li/>",{class:"ui-widget-content",data:{ismarker:t.ismarker,sref:s}}).html('<div class="handle"><span class="ui-icon ui-icon-dragndrop"></span></div>'+o+a+"</li>"))}),t&&t(i)}})},addProvider:function(){var e=$("#provider li.ui-selected").data("sref");$.ajax({url:"/bouqueteditor/api/addprovidertobouquetlist",dataType:"json",cache:!0,data:{sProviderRef:e,mode:u.Mode,date:u.date},success:function(e){e=e.Result;2==e.length&&u.showError(e[1],e[0]),u.getBouquets(u.showBouquets)}})},moveBouquet:function(e){$.ajax({url:"/bouqueteditor/api/movebouquet",dataType:"json",cache:!1,data:{sBouquetRef:e.sBouquetRef,mode:e.mode,position:e.position},success:function(){}})},addBouquet:function(){var e=prompt(tstr_bqe_name_bouquet+":");e.length&&$.ajax({url:"/bouqueteditor/api/addbouquet",dataType:"json",cache:!1,data:{name:e,mode:u.Mode},success:function(e){e=e.Result;2==e.length&&u.showError(e[1],e[0]),u.getBouquets(u.showBouquets)}})},renameBouquet:function(){var e,t,s;1===$("#bql li.ui-selected").length&&((t=$("#bql li.ui-selected")).index(),e=t.text(),t=t.data("sref"),s=prompt(tstr_bqe_rename_bouquet+":",e))&&s!=e&&$.ajax({url:"/bouqueteditor/api/renameservice",dataType:"json",cache:!1,data:{sRef:t,mode:u.Mode,newName:s},success:function(e){e=e.Result;2==e.length&&u.showError(e[1],e[0]),u.getBouquets(u.showBouquets)}})},deleteBouquet:function(){var e,t;1===$("#bql li.ui-selected").length&&(e=$("#bql li.ui-selected").text(),t=$("#bql li.ui-selected").data("sref"),!1!==confirm(tstr_bqe_del_bouquet_question+"\n"+e+" ?"))&&$.ajax({url:"/bouqueteditor/api/removebouquet",dataType:"json",cache:!1,data:{sBouquetRef:t,mode:u.Mode},success:function(e){e=e.Result;2==e.length&&u.showError(e[1],e[0]),u.getBouquets(u.showBouquets)}})},setChannelButtons:function(){var e=0==$("#channels li.ui-selected").length;$("#btn-channel-add").prop("disabled",e),$("#btn-alternative-add").prop("disabled",e)},setBouquetChannelButtons:function(){var e=$("#bqs li.ui-selected"),t=0==e.length;$("#btn-channel-delete").prop("disabled",t),$("#btn-marker-add").prop("disabled",t),$("#btn-spacer-add").prop("disabled",t),t=1!=e.length||1!=e.data("ismarker"),$("#btn-marker-group-rename").prop("disabled",t)},moveChannel:function(e){$.ajax({url:"/bouqueteditor/api/moveservice",dataType:"json",cache:!1,data:{sBouquetRef:e.sBouquetRef,sRef:e.sRef,mode:e.mode,position:e.position},success:u.renumberChannel})},renumberChannel:function(){},addChannel:function(){let e=[],t=$("#bql li.ui-selected").data("sref"),s=$("#bqs li.ui-selected").data("sref")||"";$("#channels li.ui-selected").each(function(){e.push($.ajax({url:"/bouqueteditor/api/addservicetobouquet",dataType:"json",cache:!1,data:{sBouquetRef:t,sRef:$(this).data("sref"),sRefBefore:s},success:function(){}}))}),0!==e.length&&$.when.apply($,e).then(function(){u.changeBouquet(t,u.showBouquetChannels)})},addAlternative:function(){alert("NOT implemented YET")},deleteChannel:function(){if(0!==$("#bqs li.ui-selected").length){let e=$("#bql li.ui-selected").data("sref"),t=[],a=[];if($("#bqs li.ui-selected").each(function(){t.push($(this).text()),a.push({sBouquetRef:e,mode:u.Mode,sRef:$(this).data("sref")})}),!1!==confirm(tstr_bqe_del_channel_question+"\n"+t.join(", ")+" ?")){let s=[];$.each(a,function(e,t){s.push($.ajax({url:"/bouqueteditor/api/removeservice",dataType:"json",cache:!1,data:t,success:function(){}}))}),0!==s.length&&$.when.apply($,s).then(function(){u.changeBouquet(e,u.showBouquetChannels)})}}},addMarker:function(){u._addMarker(!1)},addSpacer:function(){u._addMarker(!0)},_addMarker:function(s){let a="";if((a=s?a:prompt(tstr_bqe_name_marker+":")).length||s){let t=$("#bql li.ui-selected").data("sref");var o=$("#bqs li.ui-selected").data("sref")||"";let e={sBouquetRef:t,Name:a,sRefBefore:o};s&&(e={sBouquetRef:t,SP:"1",sRefBefore:o}),$.ajax({url:"/bouqueteditor/api/addmarkertobouquet",dataType:"json",cache:!1,data:e,success:function(e){e=e.Result;2==e.length&&u.showError(e[1],e[0]),u.changeBouquet(t,u.showBouquetChannels)}})}},renameMarkerGroup:function(){var e=$("#bqs li.ui-selected");if(1===e.length&&0!=e.data("ismarker")){e.index();var s=e.text(),e=e.data("sref");let t=$("#bql li.ui-selected").data("sref");var a=$("#bqs li.ui-selected").next().data("sref")||"",o=prompt(tstr_bqe_rename_marker+": ",s);o&&o!==s&&$.ajax({url:"/bouqueteditor/api/renameservice",dataType:"json",cache:!1,data:{sBouquetRef:t,sRef:e,newName:o,sRefBefore:a},success:function(e){e=e.Result;2==e.length&&u.showError(e[1],e[0]),u.changeBouquet(t,u.showBouquetChannels)}})}},searchChannel:function(e){let s=e.toLowerCase();u.filterChannelsCache=[],$.each(u.allChannelsCache,function(e,t){-1!==t.servicename.toLowerCase().indexOf(s)&&u.filterChannelsCache.push({servicename:t.servicename,servicereference:t.servicereference,provider:t.provider})}),u.fillChannels(u.showChannels),u.setChannelButtons()},showError:function(e,t){t=void 0!==t?t:"False",$("#statustext").text(""),!0===t||"True"===t||"true"===t?($("#statusbox").removeClass("ui-state-error").addClass("ui-state-highlight"),$("#statusicon").removeClass("ui-icon-alert").addClass("ui-icon-info")):($("#statusbox").removeClass("ui-state-highlight").addClass("ui-state-error"),$("#statusicon").removeClass("ui-icon-info").addClass("ui-icon-alert")),$("#statustext").text(e),""!==e?$("#statuscont").show():$("#statuscont").hide()},exportBouquets:function(){var e=prompt(tstr_bqe_filename+": ","bouquets_backup");e&&$.ajax({url:"/bouqueteditor/api/backup",dataType:"json",cache:!1,data:{Filename:e},success:function(e){var e=e.Result;!1===e[0]?u.showError(e[1],e[0]):(e="/bouqueteditor/tmp/"+e[1],window.open(e,"Download"))}})},importBouquets:function(){$("#rfile").trigger("click")},prepareRestore:function(){let e=$(this).val();e=e.replace("C:\\fakepath\\",""),!1!==confirm(tstr_bqe_restore_question+" ( "+e+") ?")&&($("form#uploadrestore").unbind("submit").submit(function(e){var t=new FormData(this);$.ajax({url:"/bouqueteditor/uploadrestore",type:"POST",data:t,mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,dataType:"json",success:function(e,t,s){e=e.Result;e[0]?u.doRestore(e[1]):u.showError("Upload File: "+t)},error:function(e,t,s){u.showError("Upload File Error: "+s)}}),e.preventDefault();try{e.unbind()}catch(e){}}),$("form#uploadrestore").submit())},doRestore:function(e){e&&$.ajax({url:"/bouqueteditor/api/restore",dataType:"json",cache:!1,data:{Filename:e},success:function(e){e=e.Result;2==e.length&&u.showError(e[1],e[0])}})},setup:function(){(u=this).Mode=0,u.cType=1,u.sType={1:"[SD]",16:"[SD4]",19:"[HD]","1F":"[UHD]",D3:"[OPT]"},u.hovercls=getHoverCls(),u.activecls=getActiveCls(),$("#tb1").buttonset(),$("#tb2").buttonset(),$("#tb3").buttonset(),$("#btn-provider-add").click(u.addProvider),$("#btn-channel-add").click(u.addChannel),$("#btn-alternative-add").click(u.addAlternative),$("#btn-bouquet-add").click(u.addBouquet),$("#btn-bouquet-rename").click(u.renameBouquet),$("#btn-bouquet-delete").click(u.deleteBouquet),$("#btn-channel-delete").click(u.deleteChannel),$("#btn-marker-add").click(u.addMarker),$("#btn-spacer-add").click(u.addSpacer),$("#btn-marker-group-rename").click(u.renameMarkerGroup),$("#provider").selectable({selected:function(e,t){$(t.selected).addClass("ui-selected").siblings().removeClass("ui-selected"),u.changeProvider($(t.selected).data("sref"),u.showChannels)},classes:{"ui-selected":u.activecls}}),$("#channels").selectable({stop:u.setChannelButtons,classes:{"ui-selected":u.activecls}}),$("#bql").sortable({handle:".handle",stop:function(e,t){var s=$(t.item).data("sref"),t=t.item.index();u.moveBouquet({sBouquetRef:s,mode:u.Mode,position:t})}}).selectable({filter:"li",cancel:".handle",selected:function(e,t){$(t.selected).addClass("ui-selected").siblings().removeClass("ui-selected"),u.changeBouquet($(t.selected).data("sref"),u.showBouquetChannels)},classes:{"ui-selected":u.activecls}}),$("#bqs").sortable({handle:".handle",stop:function(e,t){var s=$("#bql li.ui-selected").data("sref"),a=$(t.item).data("sref"),t=t.item.index();u.moveChannel({sBouquetRef:s,sRef:a,mode:u.Mode,position:t})}}).selectable({filter:"li",cancel:".handle",stop:u.setBouquetChannelButtons,classes:{"ui-selected":u.activecls}}),$("#toolbar-choose-tv").click(function(){u.setTvRadioMode(0)}),$("#toolbar-choose-radio").click(function(){u.setTvRadioMode(1)}),$("#toolbar-choose-satellites").click(function(){u.getSatellites(u.showProviders)}),$("#toolbar-choose-providers").click(function(){u.getProviders(u.showProviders)}),$("#toolbar-choose-channels").click(function(){$("#sel0").hide(),$("#btn-provider-add").hide(),u.getChannels(u.showChannels)}),$("#toolbar-bouquets-reload").click(function(){u.getBouquets(u.showBouquets)}),$("#toolbar-bouquets-export").click(u.exportBouquets),$("#toolbar-bouquets-import").click(u.importBouquets),$("#searchch").focus(function(){"..."===$(this).val()&&$(this).val("")}).keyup(function(){$(this).data("val")!==this.value&&u.searchChannel(this.value),$(this).data("val",this.value)}).blur(function(){$(this).data("val",""),""===$(this).val()&&$(this).val("...")}),$("#rfile").change(u.prepareRestore),u.setTvRadioMode(3)},setHover:function(e){$(e+" li").hover(function(){$(this).addClass(u.hovercls)},function(){$(this).removeClass(u.hovercls)})},getNS:function(e){e=e.toLowerCase();if(e.startsWith("ffff",0))return"DVB-C";if(e.startsWith("eeee",0))return"DVB-T";let t=parseInt(e,16)>>16&4095,s=" E";return 1800<t&&(s=" W",t=3600-t),(t/10).toFixed(1).toString()+s}}},t=new Date;e.date=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(),e.setup()}();